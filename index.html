<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VU Result Estimator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- html2canvas for Download Feature -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        /* HIDE NUMBER INPUT SPINNERS */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useRef } = React;

        // --- Icons ---
        const Calculator = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const Plus = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const Trash2 = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>;
        const AlertTriangle = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>;
        const CheckCircle2 = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>;
        const Settings = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const GraduationCap = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>;
        const Info = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const ChevronDown = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m6 9 6 6 6-6"/></svg>;
        const Download = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;
        const RotateCcw = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
        const HelpCircle = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>;
        const MessageCircle = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/></svg>;

        // --- Constants ---
        const GRADE_SCALE = [
            { label: 'A+', min: 90, gpa: '4.00', color: 'bg-green-600' },
            { label: 'A', min: 85, gpa: '4.00', color: 'bg-green-500' },
            { label: 'A-', min: 80, gpa: '3.66 - 3.99', color: 'bg-teal-500' },
            { label: 'B+', min: 75, gpa: '3.33 - 3.65', color: 'bg-blue-500' },
            { label: 'B', min: 71, gpa: '3.00 - 3.32', color: 'bg-blue-400' },
            { label: 'B-', min: 68, gpa: '2.66 - 2.99', color: 'bg-indigo-400' },
            { label: 'C', min: 61, gpa: '2.00 - 2.65', color: 'bg-yellow-500' },
            { label: 'D', min: 50, gpa: '1.00 - 1.99', color: 'bg-orange-500' },
            { label: 'F', min: 0, gpa: '0.00', color: 'bg-red-600' },
        ];

        // All possible activity types in VU
        const ACTIVITY_TYPES = [
            'Assignment', 'Quiz', 'GDB', 'Presentation', 'Term Paper', 'Project'
        ];

        // Unique Colors for each type
        const TYPE_COLORS = {
            'Assignment': { bg: 'bg-[#ff6384]', text: 'text-[#ff6384]', light: 'bg-[#ff6384]/10', border: 'border-[#ff6384]/30', ring: 'focus:ring-[#ff6384]' },
            'Quiz': { bg: 'bg-[#36a2eb]', text: 'text-[#36a2eb]', light: 'bg-[#36a2eb]/10', border: 'border-[#36a2eb]/30', ring: 'focus:ring-[#36a2eb]' },
            'GDB': { bg: 'bg-[#ff6384]', text: 'text-[#ff6384]', light: 'bg-[#ff6384]/10', border: 'border-[#ff6384]/30', ring: 'focus:ring-[#ff6384]' },
            'Presentation': { bg: 'bg-[#ff6384]', text: 'text-[#ff6384]', light: 'bg-[#ff6384]/10', border: 'border-[#ff6384]/30', ring: 'focus:ring-[#ff6384]' },
            'Term Paper': { bg: 'bg-[#ff6384]', text: 'text-[#ff6384]', light: 'bg-[#ff6384]/10', border: 'border-[#ff6384]/30', ring: 'focus:ring-[#ff6384]' },
            'Project': { bg: 'bg-[#ff6384]', text: 'text-[#ff6384]', light: 'bg-[#ff6384]/10', border: 'border-[#ff6384]/30', ring: 'focus:ring-[#ff6384]' },
            
            // Midterm and Final specific colors
            'Midterm': { bg: 'bg-[#ff9f40]', text: 'text-[#ff9f40]', light: 'bg-[#ff9f40]/10', border: 'border-[#ff9f40]/30', ring: 'focus:ring-[#ff9f40]' },
            'Final': { bg: 'bg-[#ffcd56]', text: 'text-[#ffcd56]', light: 'bg-[#ffcd56]/10', border: 'border-[#ffcd56]/30', ring: 'focus:ring-[#ffcd56]' }
        };

        // --- Main Application ---
        const VUResultEstimator = () => {
            const [showSettings, setShowSettings] = useState(true);
            const [showHelp, setShowHelp] = useState(false);
            const [isDownloading, setIsDownloading] = useState(false);
            const [courseCode, setCourseCode] = useState('');
            const reportRef = useRef(null);

            // --- Scheme State (Granular Weights) ---
            const [scheme, setScheme] = useState({
                Assignment: 10,
                Quiz: 5,
                GDB: 5,
                Presentation: 0,
                'Term Paper': 0,
                Project: 0,
                Midterm: 20,
                Final: 60
            });

            // --- Activities Data ---
            const [activities, setActivities] = useState([
                { id: 1, type: 'Assignment', name: 'Assignment 1', obtained: 0, total: 10 },
                { id: 2, type: 'Quiz', name: 'Quiz 1', obtained: 0, total: 10 },
            ]);

            const [midterm, setMidterm] = useState({ obtained: 0, total: 40 });
            const [final, setFinal] = useState({ obtained: 0, total: 60 });

            // --- Handlers ---
            const handleSchemeChange = (type, value) => {
                const val = parseFloat(value);
                setScheme(prev => ({ ...prev, [type]: isNaN(val) ? 0 : val }));
            };

            const addActivity = () => {
                const newId = activities.length > 0 ? Math.max(...activities.map(a => a.id)) + 1 : 1;
                setActivities([...activities, { id: newId, type: 'Assignment', name: `Activity ${newId}`, obtained: 0, total: 10 }]);
            };

            const removeActivity = (id) => {
                setActivities(activities.filter(a => a.id !== id));
            };

            const updateActivity = (id, field, value) => {
                setActivities(activities.map(a => {
                    if (a.id !== id) return a;
                    if (field === 'name' || field === 'type') return { ...a, [field]: value };
                    const num = parseFloat(value);
                    return { ...a, [field]: isNaN(num) ? 0 : num };
                }));
            };

            const handleFocus = (e) => e.target.select();

            const resetAll = () => {
                if (confirm('Are you sure you want to clear all data?')) {
                    setActivities([{ id: 1, type: 'Assignment', name: 'Assignment 1', obtained: 0, total: 10 }]);
                    setMidterm({ obtained: 0, total: 40 });
                    setFinal({ obtained: 0, total: 60 });
                    setScheme({
                        Assignment: 10, Quiz: 5, GDB: 5, Presentation: 0, 'Term Paper': 0, Project: 0, Midterm: 20, Final: 60
                    });
                    setCourseCode('');
                }
            };

            const handleDownload = async () => {
                if (reportRef.current) {
                    setIsDownloading(true);
                    try {
                        const canvas = await html2canvas(reportRef.current, {
                            scale: 2,
                            backgroundColor: '#ffffff',
                            useCORS: true
                        });
                        const image = canvas.toDataURL("image/png");
                        const link = document.createElement('a');
                        link.href = image;
                        const safeName = courseCode.replace(/[^a-z0-9]/gi, '_').trim() || 'VU_Result';
                        link.download = `${safeName}_Projected_Result.png`;
                        link.click();
                    } catch (error) {
                        alert("Download failed.");
                    } finally {
                        setIsDownloading(false);
                    }
                }
            };

            // --- CALCULATIONS (BUCKET LOGIC) ---
            
            // Helper to calculate score for a single bucket (e.g., all Quizzes)
            const calculateBucket = (type) => {
                const typeActs = activities.filter(a => a.type === type);
                const obtained = typeActs.reduce((s, a) => s + a.obtained, 0);
                const total = typeActs.reduce((s, a) => s + a.total, 0);
                const percentage = total > 0 ? (obtained / total) * 100 : 0;
                const weight = scheme[type] || 0;
                const contribution = (percentage * weight) / 100;
                return { obtained, total, percentage, contribution, weight };
            };

            // Calculate all Semester Work buckets
            const semesterStats = useMemo(() => {
                let totalContribution = 0;
                const breakdown = {};
                ACTIVITY_TYPES.forEach(type => {
                    if (scheme[type] > 0) { 
                        const stats = calculateBucket(type);
                        breakdown[type] = stats;
                        totalContribution += stats.contribution;
                    }
                });
                return { contribution: totalContribution, breakdown };
            }, [activities, scheme]);

            // Midterm
            const midtermStats = useMemo(() => {
                const percentage = midterm.total > 0 ? (midterm.obtained / midterm.total) * 100 : 0;
                const contribution = (percentage * scheme.Midterm) / 100;
                return { percentage, contribution, weight: scheme.Midterm };
            }, [midterm, scheme.Midterm]);

            // Final
            const finalStats = useMemo(() => {
                const percentage = final.total > 0 ? (final.obtained / final.total) * 100 : 0;
                const contribution = (percentage * scheme.Final) / 100;
                return { percentage, contribution, weight: scheme.Final };
            }, [final, scheme.Final]);

            // Total
            const totalStats = useMemo(() => {
                const totalPercentage = semesterStats.contribution + midtermStats.contribution + finalStats.contribution;
                let grade = GRADE_SCALE.find(g => totalPercentage >= g.min) || GRADE_SCALE[GRADE_SCALE.length - 1];
                let risk = 'Safe';
                let riskColor = 'text-green-600';
                if (grade.label === 'F' || grade.label === 'D') {
                    risk = 'High Risk';
                    riskColor = 'text-red-600';
                } else if (grade.label === 'C' || grade.label === 'B-') {
                    risk = 'Borderline';
                    riskColor = 'text-yellow-600';
                }
                return { totalPercentage, grade, risk, riskColor };
            }, [semesterStats, midtermStats, finalStats]);

            // Required Marks
            const requiredMarks = useMemo(() => {
                const currentScore = semesterStats.contribution + midtermStats.contribution;
                return GRADE_SCALE.map(grade => {
                    const target = grade.min;
                    const neededContribution = target - currentScore;
                    if (neededContribution <= 0) return { ...grade, status: 'Achieved', marks: 0 };
                    const neededRawPercentage = (neededContribution / scheme.Final) * 100;
                    const neededRawMarks = (neededRawPercentage / 100) * final.total;
                    if (neededRawMarks > final.total) return { ...grade, status: 'Impossible', marks: neededRawMarks };
                    return { ...grade, status: 'Possible', marks: neededRawMarks };
                });
            }, [semesterStats.contribution, midtermStats.contribution, scheme.Final, final.total]);

            // Validation
            const totalSchemeWeight = Object.values(scheme).reduce((a, b) => a + b, 0);
            const isSchemeError = totalSchemeWeight !== 100;

            const midColor = TYPE_COLORS['Midterm'];
            const finColor = TYPE_COLORS['Final'];

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans pb-12">
                <header className="bg-blue-900 text-white p-4 shadow-lg sticky top-0 z-50">
                    <div className="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                        <div className="flex items-center gap-3">
                            <GraduationCap className="w-8 h-8 text-yellow-400" />
                            <div>
                                <h1 className="text-xl md:text-2xl font-bold">VU Result Estimator</h1>
                                <p className="text-blue-200 text-xs md:text-sm">Bucket-Based Grading Scheme</p>
                            </div>
                        </div>
                        <div className="flex flex-wrap items-center justify-center gap-3">
                            <div className="flex items-center gap-2 bg-blue-800/50 p-2 rounded-lg border border-blue-700">
                                <span className="text-xs text-blue-200 font-semibold uppercase tracking-wider">Course:</span>
                                <input 
                                    type="text"
                                    placeholder="CS101"
                                    value={courseCode}
                                    onChange={(e) => setCourseCode(e.target.value)}
                                    className="bg-transparent text-white placeholder-blue-300/50 focus:outline-none w-20 font-bold text-center uppercase text-sm"
                                />
                            </div>
                            <a 
                                href="https://whatsapp.com/channel/0029Va7fciT84OmBqXE5ua0M" 
                                target="_blank"
                                className="flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-bold transition shadow-sm"
                            >
                                <MessageCircle className="w-4 h-4" />
                                Join Channel
                            </a>
                        </div>
                    </div>
                </header>

                <main className="max-w-6xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
                    
                    {/* LEFT COLUMN: Inputs */}
                    <div className="lg:col-span-2 space-y-6">

                    {/* Step 1: Assessment Scheme Config */}
                    <div className="bg-white p-6 rounded-xl shadow-md border-l-4 border-blue-600 animate-in slide-in-from-top-4">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="font-bold text-lg text-gray-800 flex items-center gap-2">
                                <Settings className="w-5 h-5 text-blue-600" />
                                1. Grading Scheme
                            </h3>
                            <button 
                                onClick={() => setShowSettings(!showSettings)}
                                className="text-gray-400 hover:text-blue-600"
                            >
                                <ChevronDown className={`w-5 h-5 transition-transform ${showSettings ? 'rotate-180' : ''}`} />
                            </button>
                        </div>
                        
                        {showSettings && (
                            <div className="animate-in fade-in">
                                <p className="text-xs text-gray-500 mb-4 bg-blue-50 p-2 rounded">
                                    Define the weightage for each component. Set to 0 if not applicable.
                                </p>
                                <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                    {ACTIVITY_TYPES.map(type => {
                                        const color = TYPE_COLORS[type];
                                        return (
                                            <div key={type}>
                                                <label className={`block text-xs font-bold ${color.text} mb-1`}>{type}</label>
                                                <div className="relative">
                                                    <input 
                                                        type="number" min="0" max="100"
                                                        value={scheme[type]}
                                                        onFocus={handleFocus}
                                                        onChange={(e) => handleSchemeChange(type, e.target.value)}
                                                        className={`w-full border rounded-lg p-2 text-sm font-bold text-center focus:ring-2 ${color.ring} outline-none`}
                                                    />
                                                    <span className="absolute right-2 top-2 text-xs text-gray-400">%</span>
                                                </div>
                                            </div>
                                        );
                                    })}
                                    <div className="sm:col-span-1 border-l pl-4 border-gray-100">
                                        <label className={`block text-xs font-bold ${midColor.text} mb-1`}>Midterm</label>
                                        <div className="relative">
                                            <input 
                                                type="number" min="0" max="100"
                                                value={scheme.Midterm}
                                                onFocus={handleFocus}
                                                onChange={(e) => handleSchemeChange('Midterm', e.target.value)}
                                                className={`w-full border rounded-lg p-2 text-sm font-bold text-center focus:ring-2 ${midColor.ring} outline-none ${midColor.text}`}
                                            />
                                            <span className="absolute right-2 top-2 text-xs text-gray-400">%</span>
                                        </div>
                                    </div>
                                    <div className="sm:col-span-1">
                                        <label className={`block text-xs font-bold ${finColor.text} mb-1`}>Final</label>
                                        <div className="relative">
                                            <input 
                                                type="number" min="0" max="100"
                                                value={scheme.Final}
                                                onFocus={handleFocus}
                                                onChange={(e) => handleSchemeChange('Final', e.target.value)}
                                                className={`w-full border rounded-lg p-2 text-sm font-bold text-center focus:ring-2 ${finColor.ring} outline-none ${finColor.text}`}
                                            />
                                            <span className="absolute right-2 top-2 text-xs text-gray-400">%</span>
                                        </div>
                                    </div>
                                </div>
                                {isSchemeError && (
                                    <div className="mt-3 text-red-600 text-xs font-bold flex items-center gap-1 justify-end">
                                        <AlertTriangle className="w-4 h-4" />
                                        Total: {totalSchemeWeight}% (Must be 100%)
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Step 2: Activities */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-lg font-bold text-gray-800">2. Semester Activities</h2>
                        </div>
                        
                        <div className="space-y-3">
                            {activities.map((activity) => {
                                const color = TYPE_COLORS[activity.type] || TYPE_COLORS['Assignment'];
                                return (
                                    <div key={activity.id} className={`flex flex-col sm:flex-row sm:items-end gap-3 p-3 rounded-lg group border transition relative ${color.light} ${color.border}`}>
                                        <div className="w-full sm:w-1/4">
                                            <label className="text-xs text-gray-500 block mb-1 font-medium">Type</label>
                                            <select
                                                value={activity.type}
                                                onChange={(e) => updateActivity(activity.id, 'type', e.target.value)}
                                                className={`w-full bg-white border border-gray-300 rounded px-2 py-1.5 text-sm focus:outline-none focus:border-blue-500 cursor-pointer ${color.text} font-bold`}
                                            >
                                                {ACTIVITY_TYPES.map(type => (
                                                    <option key={type} value={type}>{type} ({scheme[type]}%)</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div className="flex-grow">
                                            <label className="text-xs text-gray-500 block mb-1 font-medium">Name</label>
                                            <input 
                                                type="text" 
                                                value={activity.name}
                                                onChange={(e) => updateActivity(activity.id, 'name', e.target.value)}
                                                className="w-full bg-white border border-gray-300 rounded px-2 py-1.5 text-sm focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                        <div className="flex gap-2 w-full sm:w-auto">
                                            <div className="w-1/2 sm:w-20">
                                                <label className="text-xs text-gray-500 block mb-1 font-medium">Obtained</label>
                                                <input 
                                                    type="number" min="0"
                                                    value={activity.obtained}
                                                    onFocus={handleFocus}
                                                    onChange={(e) => updateActivity(activity.id, 'obtained', e.target.value)}
                                                    className="w-full bg-white border border-gray-300 rounded px-2 py-1.5 text-sm focus:outline-none focus:border-blue-500 text-center font-bold"
                                                />
                                            </div>
                                            <div className="w-1/2 sm:w-20">
                                                <label className="text-xs text-gray-500 block mb-1 font-medium">Total</label>
                                                <input 
                                                    type="number" min="0"
                                                    value={activity.total}
                                                    onFocus={handleFocus}
                                                    onChange={(e) => updateActivity(activity.id, 'total', e.target.value)}
                                                    className="w-full bg-white border border-gray-300 rounded px-2 py-1.5 text-sm focus:outline-none focus:border-blue-500 text-center"
                                                />
                                            </div>
                                        </div>
                                        <button 
                                            onClick={() => removeActivity(activity.id)}
                                            className="absolute -top-2 -right-2 bg-white text-gray-400 hover:text-red-500 p-1 rounded-full shadow border hover:bg-red-50 transition"
                                        >
                                            <Trash2 className="w-3 h-3" />
                                        </button>
                                    </div>
                                );
                            })}
                        </div>

                        <div className="mt-4 flex justify-between items-center">
                            <button 
                                onClick={addActivity}
                                className="flex items-center gap-1 text-sm font-bold text-blue-600 hover:text-blue-800 transition bg-blue-50 px-3 py-1.5 rounded-lg hover:bg-blue-100"
                            >
                                <Plus className="w-4 h-4" /> Add Activity
                            </button>
                            <div className="text-right text-xs text-gray-400">
                                Activities are grouped by type automatically.
                            </div>
                        </div>
                    </div>

                    {/* Midterm & Final Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* 3. Midterm */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-lg font-bold text-gray-800">3. Midterm</h2>
                                <span className={`text-xs font-bold ${midColor.text} ${midColor.light} px-2 py-1 rounded`}>
                                    {scheme.Midterm}% Weight
                                </span>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs text-gray-500 block mb-1">Obtained</label>
                                    <input 
                                        type="number" min="0"
                                        value={midterm.obtained}
                                        onFocus={handleFocus}
                                        onChange={(e) => setMidterm({...midterm, obtained: parseFloat(e.target.value) || 0})}
                                        className={`w-full border-2 border-gray-100 rounded-lg p-2 font-bold ${midColor.text} focus:outline-none ${midColor.ring}`}
                                    />
                                </div>
                                <div>
                                    <label className="text-xs text-gray-500 block mb-1">Total</label>
                                    <input 
                                        type="number" min="0"
                                        value={midterm.total}
                                        onFocus={handleFocus}
                                        onChange={(e) => setMidterm({...midterm, total: parseFloat(e.target.value) || 0})}
                                        className={`w-full border border-gray-200 rounded-lg p-2 focus:outline-none ${midColor.ring}`}
                                    />
                                </div>
                            </div>
                        </div>

                        {/* 4. Final */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-lg font-bold text-gray-800">4. Final Exam</h2>
                                <span className={`text-xs font-bold ${finColor.text} ${finColor.light} px-2 py-1 rounded`}>
                                    {scheme.Final}% Weight
                                </span>
                            </div>
                            <div>
                                <label className="text-xs text-gray-500 block mb-1">Expected / Obtained</label>
                                <div className="flex gap-2">
                                    <input 
                                        type="number" min="0"
                                        value={final.obtained}
                                        onFocus={handleFocus}
                                        onChange={(e) => setFinal({...final, obtained: parseFloat(e.target.value) || 0})}
                                        className={`w-24 border-2 border-gray-100 rounded-lg p-2 font-bold ${finColor.text} focus:outline-none ${finColor.ring}`}
                                    />
                                    <div className="flex items-center text-gray-400">/ {final.total}</div>
                                    <input 
                                        type="range" min="0" max={final.total}
                                        value={final.obtained}
                                        onChange={(e) => setFinal({...final, obtained: parseFloat(e.target.value) || 0})}
                                        className="flex-grow accent-[#ffcd56]"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>

                    {/* RIGHT COLUMN: Report */}
                    <div className="lg:col-span-1">
                        <div className="sticky top-20 space-y-6">
                            
                            {/* DOWNLOADABLE AREA */}
                            <div ref={reportRef} className="space-y-4 bg-gray-50 p-4 -m-4 sm:m-0 sm:p-2 rounded-xl">
                                
                                {courseCode && (
                                    <div className="text-center pb-2">
                                        <h3 className="text-2xl font-bold text-gray-800 uppercase tracking-widest">{courseCode}</h3>
                                        <p className="text-xs text-gray-500 tracking-wide">Projected Performance Report</p>
                                    </div>
                                )}

                                {/* Main Card */}
                                <div className="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                                    <div className="bg-gray-900 p-6 text-white text-center">
                                        <h2 className="text-xs font-bold uppercase tracking-widest text-gray-400 mb-2">Total Aggregate</h2>
                                        <div className="flex justify-center items-baseline gap-1">
                                            <span className="text-5xl font-extrabold tracking-tight">{totalStats.totalPercentage.toFixed(2)}</span>
                                            <span className="text-xl text-gray-400">%</span>
                                        </div>
                                        <div className={`inline-block px-4 py-1 rounded-full mt-4 text-xs font-bold ${totalStats.grade.color}`}>
                                            {totalStats.grade.label} (GPA {totalStats.grade.gpa})
                                        </div>
                                    </div>

                                    {/* SCHEME BREAKDOWN VISUALIZATION */}
                                    <div className="p-4 border-b border-gray-100">
                                        <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Scheme Contribution Breakdown</h4>
                                        <div className="space-y-2">
                                            {Object.entries(semesterStats.breakdown).map(([type, stats]) => {
                                                const color = TYPE_COLORS[type];
                                                return (
                                                    <div key={type} className="flex items-center text-xs">
                                                        <div className={`w-24 font-bold ${color.text}`}>{type}</div>
                                                        <div className="flex-grow bg-gray-100 rounded-full h-2 mr-2 overflow-hidden">
                                                            <div className={`${color.bg} h-full rounded-full`} style={{width: `${(stats.contribution / (stats.weight || 1)) * 100}%`}}></div>
                                                        </div>
                                                        <div className={`w-12 text-right font-bold ${color.text}`}>{stats.contribution.toFixed(2)}%</div>
                                                    </div>
                                                );
                                            })}
                                            <div className="flex items-center text-xs">
                                                <div className={`w-24 font-bold ${midColor.text}`}>Midterm</div>
                                                <div className="flex-grow bg-gray-100 rounded-full h-2 mr-2 overflow-hidden">
                                                    <div className={`${midColor.bg} h-full rounded-full`} style={{width: `${(midtermStats.contribution / (scheme.Midterm || 1)) * 100}%`}}></div>
                                                </div>
                                                <div className={`w-12 text-right font-bold ${midColor.text}`}>{midtermStats.contribution.toFixed(2)}%</div>
                                            </div>
                                            <div className="flex items-center text-xs">
                                                <div className={`w-24 font-bold ${finColor.text}`}>Final</div>
                                                <div className="flex-grow bg-gray-100 rounded-full h-2 mr-2 overflow-hidden">
                                                    <div className={`${finColor.bg} h-full rounded-full`} style={{width: `${(finalStats.contribution / (scheme.Final || 1)) * 100}%`}}></div>
                                                </div>
                                                <div className={`w-12 text-right font-bold ${finColor.text}`}>{finalStats.contribution.toFixed(2)}%</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="p-4 bg-gray-50 flex justify-between items-center">
                                        <span className="text-xs font-bold text-gray-500">Risk Level</span>
                                        <span className={`text-xs font-bold flex items-center gap-1 ${totalStats.riskColor}`}>
                                            {totalStats.risk === 'Safe' ? <CheckCircle2 className="w-3 h-3"/> : <AlertTriangle className="w-3 h-3"/>}
                                            {totalStats.risk}
                                        </span>
                                    </div>
                                </div>

                                {/* Required Marks */}
                                <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                                    <h3 className="font-bold text-gray-700 text-sm mb-3 flex items-center gap-2">
                                        <Calculator className="w-4 h-4 text-gray-400" />
                                        Target: Final Exam
                                    </h3>
                                    <div className="grid grid-cols-1 gap-1">
                                    {[...requiredMarks].reverse().map((req, idx) => (
                                        <div key={idx} className={`flex justify-between items-center p-2 rounded text-xs ${
                                            req.status === 'Achieved' ? 'bg-green-50' : 'bg-white'
                                        }`}>
                                            <div className="flex items-center gap-2">
                                                <span className={`w-5 h-5 flex items-center justify-center rounded text-white font-bold text-[10px] ${req.color}`}>
                                                    {req.label}
                                                </span>
                                            </div>
                                            <div className="font-medium">
                                                {req.status === 'Achieved' ? (
                                                    <span className="text-green-600">Secured</span>
                                                ) : req.status === 'Impossible' ? (
                                                    <span className="text-gray-300">N/A</span>
                                                ) : (
                                                    <span className="text-gray-800">
                                                        {Math.ceil(req.marks)} <span className="text-gray-400">/ {final.total}</span>
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                    </div>
                                </div>
                            </div>

                            <button 
                                onClick={handleDownload}
                                disabled={isDownloading}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow transition flex items-center justify-center gap-2 disabled:opacity-50"
                            >
                                {isDownloading ? "Generating..." : <><Download className="w-5 h-5" /> Save Report</>}
                            </button>

                             <div className="flex justify-center gap-3">
                                <button 
                                    onClick={resetAll}
                                    className="text-xs text-red-400 hover:text-red-600 flex items-center gap-1 transition"
                                >
                                    <RotateCcw className="w-3 h-3" /> Reset
                                </button>
                            </div>

                            {/* Help & FAQ Section */}
                            <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                                <button 
                                    onClick={() => setShowHelp(!showHelp)}
                                    className="w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition group"
                                >
                                    <div className="flex items-center gap-2 font-bold text-gray-700 group-hover:text-blue-700">
                                        <HelpCircle className="w-5 h-5 text-blue-600" />
                                        How to Use & FAQs
                                    </div>
                                    <ChevronDown className={`w-5 h-5 text-gray-400 transition-transform duration-200 ${showHelp ? 'rotate-180' : ''}`} />
                                </button>
                                
                                {showHelp && (
                                    <div className="p-4 text-xs text-gray-600 space-y-4 border-t border-gray-100 bg-white animate-in slide-in-from-top-2">
                                        <div className="space-y-2">
                                            <h4 className="font-bold text-blue-700 uppercase tracking-wide">Quick Guide</h4>
                                            <ol className="list-decimal list-inside space-y-1 ml-1 text-gray-500">
                                                <li>Set grading weights in <strong>Scheme Config</strong>.</li>
                                                <li>Add all your Assignments/Quizzes.</li>
                                                <li>Enter Midterm & Expected Final marks.</li>
                                                <li>Check the projected Grade & GPA.</li>
                                            </ol>
                                        </div>
                                        <div className="space-y-2 border-t pt-2 border-gray-100">
                                            <h4 className="font-bold text-blue-700 uppercase tracking-wide">FAQs</h4>
                                            <div>
                                                <p className="font-bold text-gray-800">Q: How accurate is this tool?</p>
                                                <p>A: It uses exact mathematical averages. However, official results may vary slightly due to university normalization curves.</p>
                                            </div>
                                            <div>
                                                <p className="font-bold text-gray-800">Q: Is this the final version?</p>
                                                <p>A: Yes, this version supports the latest grading buckets and dynamic schemes.</p>
                                            </div>
                                            <div>
                                                <p className="font-bold text-gray-800">Q: I found an issue?</p>
                                                <p>A: Contact me directly via WhatsApp at <a href="https://wa.me/+923156229141" className="text-green-600 font-bold hover:underline">0315-6229141</a>.</p>
                                            </div>
                                            <div className="pt-2">
                                                <a href="https://whatsapp.com/channel/0029Va7fciT84OmBqXE5ua0M" target="_blank" className="block text-center bg-green-100 text-green-700 py-2 rounded font-bold hover:bg-green-200 transition">
                                                    Join Our Support Group
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>

                        </div>
                    </div>
                </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VUResultEstimator />);
    </script>
</body>
</html>
